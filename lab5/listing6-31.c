/* Listing 6-31 from textbook (The Art of Software Security Assessment by
 *                            Dowd, McDonald, and Schuh)
 */

#define GET32(x) (*((unsigned int *)(x))++)

u_char *copy_packet(u_char *packet)

{
   int *w = (int *)packet;
   unsigned int hdrvar, datasize;

   /* packet format is hdr var, data size, padding size */

   hdrvar = GET32(w);

   if (hdrvar & FLAG_PADDING)
       datasize = GET32(w) - GET32(w);
   else
       datasize = GET32(w);

   ...
}

